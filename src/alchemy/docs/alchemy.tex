\documentclass[aps]{revtex4}
\usepackage{graphicx}
\usepackage{amssymb,amsfonts,amsmath,amsthm}
\usepackage{chemarr}
\usepackage{bm}
\usepackage{bbm}
\usepackage{pslatex}
\usepackage{mathptmx}
\usepackage{xfrac}

\newcommand{\mymat}[1]{\bm{#1}}
\newcommand{\mytrn}[1]{~^{\mathsf{T}}{#1}}
\newcommand{\mygrad}{\vec{\nabla}}

\begin{document}
\title{Chemical Solutions}

\section{Description}
Let us assume that we have $A_1,\ldots,A_M$ chemical species coupled by
$N$ equilibria such that
\begin{equation}
	\forall i \in [1;N], \;\; \sum_{j=1}^{M} \nu_{i,j} C_i = 0, \;\; K_i(t) = \prod_{i=1}^{M} C_i^{\nu_{i,j}}.
\end{equation}
We remove the singularities by assuming that the equilibria are met when
\begin{equation}
	\forall i \in [1;N], \;\; \Gamma_i(t,\vec{C}) = K_i(t) \prod_{\nu_{i,j}<0}  C_i^{-\nu_{i,j}} -  \prod_{\nu_{i,j}>0} C_i^{\nu_{i,j}} 
\end{equation}
or
\begin{equation}
	\vec{\Gamma}(t,\vec{C}) = \vec{0}.
\end{equation}
We also naturally have the topology matrix $\mymat{\nu}$, such that
any chemical shift is defined by a  chemical extent vector $\vec{\xi}$ and
produces a shift
$$
	\delta\vec{C}=\mytrn{\mymat{\nu}}\vec{\xi}
$$

\section{Balancing Concentrations}
\subsection{Method}

Let us assume that we define a continuously derivable objective function $\mathcal{E}\left(\vec{C}\right)$ which is minimal (with value 0) when all active species are positive. Whenever one of those concentrations is negative, we want to find an excess
$\delta\vec{C}$ such that
\begin{equation}
	\mathcal{E}\left(\vec{C}+\delta\vec{C}\right) \leq 0
\end{equation}

Let $\vec{\beta}$ be the steepest descent direction of $\mathcal{E}$,
\begin{equation}
	\vec{\beta} = -\partial_{\vec{C}} \mathcal{E}.
\end{equation}
Since
\begin{equation}
	\mathcal{E}
	\left(\vec{C}+\mytrn{\mymat{\nu}}\vec{\xi}\right) 
	\simeq \mathcal{E}\left(\vec{C}\right) - \vec{\beta} \cdot \mytrn{\mymat{\nu}}\vec{\xi}
	= \mathcal{E}\left(\vec{C}\right) - \mymat{\nu}\vec{\beta}\cdot\vec{\xi},
\end{equation}
the steepest descent direction w.r.t the extent is $\mymat{\nu}\vec{\beta}$, which turns into
a steepest concentration descent 
\begin{equation}
	\vec{g} = \mytrn{\mymat{\nu}} \mymat{\nu} \, \vec{\beta}
\end{equation}
%so that we want to find an extent $\vec{\xi}$ which minimises $\mathcal{F}(\alpha)=\mathcal{E}(\vec{C} + \alpha

We may use
\begin{equation}
\mathcal{E}\left(\vec{C}\right) = 
\end{equation}

Hence we can write a modified conjugated gradient algorithm, which makes sens only if there is
an invalid concentration

\begin{enumerate}
\item Initialize $\vec{g}$, check that $g_2=\vert\vec{g}\vert^2>0$. Set $\vec{h}=\vec{g}$.
\item Find the minimum, w.r.t $\alpha$ of $\mathcal{E}\left(\vec{C}+\alpha \vec{h}\right)$. 
\item Update $\vec{C}$ to $\vec{C}+\alpha\vec{h}$. If the minimum is zero, terminate the algorithm.
\item Compute the temporary steepest descent $\vec{b}$, check that $b_2=\vert\vec{b}\vert^2>0$.
\item Compute $\gamma=\dfrac{\left(\vec{b}-\vec{g}\right)\cdot \vec{b}}{g_2}$.
\item Update $\vec{g} = \vec{b}$
\item Update $\vec{h} = \vec{g} + \gamma \vec{h}$
\end{enumerate}



\end{document}


\section{Balancing Concentrations}
\subsection{Method}

Let us assume that we define an objective function $\mathcal{E}\left(\vec{C}\right)$ which is minimal (with value 0) when all active species are positive. Whenever one of those concentrations is negative, we want to find an excess
$\delta\vec{C}$ such that
\begin{equation}
	\mathcal{E}\left(\vec{C}+\delta\vec{C}\right).
\end{equation}
Locally, we have
\begin{equation}
	\mathcal{E}\left(\vec{C}+\mytrn{\mymat{\nu}}\vec{\xi}\right) \simeq 
	\mathcal{E}\left(\vec{C}\right) - \vec{\beta}\cdot\delta\vec{C} = \mathcal{E}\left(\vec{C}\right) - \vec{\xi}\cdot \mymat{\nu}\vec{\beta}
\end{equation}
where
\begin{equation}
	\vec{\beta} = -\partial_{\vec{C}} \mathcal{E}
\end{equation}


